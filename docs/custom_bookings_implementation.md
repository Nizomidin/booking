# Реализация удаления кастомных бронирований

## Внесенные изменения

### 1. Модификация обработчика удаления бронирований в `MasterProfile.jsx`

Основная функция `handleDeleteBooking` была модифицирована для обработки как стандартных, так и кастомных бронирований:
- Добавлена проверка типа бронирования (стандартное или кастомное)
- Реализована поддержка разных API-эндпоинтов в зависимости от типа
- Добавлены соответствующие сообщения об успехе/ошибке, учитывающие тип бронирования

```jsx
const handleDeleteBooking = async (bookingId) => {
  if (!window.confirm("Вы уверены, что хотите удалить эту запись?")) {
    return;
  }
  
  // Проверяем, является ли запись кастомной
  const isCustomBooking = selectedBooking && selectedBooking.is_custom;
  const endpoint = isCustomBooking 
      ? `${API_BASE}/custom_appointments/${bookingId}`
      : `${API_BASE}/appointments/${bookingId}`;

  try {
    const res = await fetch(endpoint, {
      method: "DELETE",
      headers: {
        accept: "application/json"
      },
    });

    if (!res.ok) throw new Error(`Не удалось удалить ${isCustomBooking ? 'кастомную ' : ''}запись`);

    // Если это была выбранная запись, сбрасываем выбор
    if (selectedBooking && selectedBooking.id === bookingId) {
      setSelectedBooking(null);
      setView("calendar");
    }
    
    showSuccess(`${isCustomBooking ? 'Кастомная запись' : 'Запись'} успешно удалена`);
    
    // Автоматическое обновление страницы
    window.location.reload();
  } catch (err) {
    console.error(`Ошибка при удалении ${isCustomBooking ? 'кастомной ' : ''}записи:`, err);
    showError(`Ошибка при удалении ${isCustomBooking ? 'кастомной ' : ''}записи: ${err.message}`);
  }
};
```

### 2. Добавление обработчика для редактирования кастомных бронирований

Добавлен новый обработчик для редактирования кастомных бронирований и модифицирован основной обработчик для определения типа бронирования:

```jsx
// Обработчик изменения кастомной записи
const handleUpdateCustomBooking = async (bookingId, updatedData) => {
  try {
    // Проверяем структуру данных, которую ожидает API
    const formattedData = {
      ...updatedData,
      master_id: masterId
    };

    const res = await fetch(`${API_BASE}/custom_appointments/${bookingId}`, {
      method: "PATCH",
      headers: {
        "Content-Type": "application/json",
        accept: "application/json"
      },
      body: JSON.stringify(formattedData),
    });

    if (!res.ok) throw new Error("Не удалось обновить кастомную запись");

    const updatedBooking = await res.json();
    if (selectedBooking && selectedBooking.id === bookingId) {
      setSelectedBooking(updatedBooking);
    }

    showSuccess("Кастомная запись успешно обновлена");
    window.location.reload();
  } catch (err) {
    console.error("Ошибка при обновлении кастомной записи:", err);
    showError(`Ошибка при обновлении кастомной записи: ${err.message}`);
  }
};
```

### 3. Модификация компонента `BookingDetails.jsx`

Обновлен для поддержки отображения и редактирования кастомных бронирований:

- Добавлена логика обработки дат в формате "YYYY-MM-DD HH:MM" для кастомных бронирований
- Добавлено отображение времени окончания для кастомных бронирований
- Улучшена подготовка данных для отправки на сервер в зависимости от типа бронирования

### 4. Модификация компонента `MasterCalendar.jsx`

Обновлен для корректного отображения кастомных бронирований в календаре:
- Добавлена обработка данных в формате "YYYY-MM-DD HH:MM"
- Реализована поддержка отображения времени окончания для кастомных бронирований
- Добавлены стили для визуального отличия кастомных бронирований в календаре

### 5. Добавлен тестовый скрипт `test_custom_bookings.js`

Для тестирования работы кастомных бронирований, включая:
- Создание тестового кастомного бронирования
- Редактирование кастомных бронирований
- Удаление кастомных бронирований
- Полный цикл тестирования функциональности

## Инструкция по тестированию

1. Запустите приложение (`npm start`)
2. Импортируйте тестовый скрипт в `src/index.js`:
   ```javascript
   import './test_custom_bookings.js';
   ```
3. В консоли браузера выполните:
   ```javascript
   window.testCustomBooking.runTests()
   ```
4. Проверьте в интерфейсе мастера:
   - Создание кастомного бронирования
   - Отображение кастомного бронирования в календаре с зеленой полосой
   - Отображение деталей кастомного бронирования (время начала и окончания)
   - Удаление кастомного бронирования

## Дальнейшие улучшения

1. Улучшение UI/UX для работы с кастомными бронированиями:
   - Добавление формы для указания точного времени окончания
   - Улучшение визуального отображения кастомных бронирований в календаре

2. Добавление фильтрации по типам бронирований:
   - Возможность показать/скрыть кастомные бронирования
   - Статистика по количеству кастомных и стандартных бронирований

3. Дополнительное тестирование:
   - Unit-тесты для компонентов
   - Интеграционные тесты для взаимодействия с API
