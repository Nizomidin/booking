# Реализация кастомных бронирований

## Обзор

Функциональность кастомных бронирований позволяет создавать и управлять бронированиями с произвольным временем начала и окончания. Они хранятся в отдельном API-эндпоинте `/custom_appointments` и имеют дополнительные поля по сравнению с обычными бронированиями.

## Ключевые особенности

1. **Ручной ввод времени**: Кастомные бронирования позволяют мастеру вручную задать точное время начала и окончания услуги.
2. **Отдельный API-эндпоинт**: Кастомные бронирования используют отдельный API-эндпоинт `/custom_appointments`.
3. **Специальный флаг**: Для идентификации кастомных бронирований используется флаг `is_custom`.
4. **Отображение времени окончания**: В интерфейсе дополнительно показывается время окончания услуги.

## Структура данных

### Обычные бронирования

```json
{
  "id": "12345",
  "client_name": "Иван Иванов",
  "service_id": "567",
  "service_name": "Стрижка",
  "appointment_datetime": "2023-05-15 14:30:00",
  "comment": "Заметка",
  "status": "booked"
}
```

### Кастомные бронирования

```json
{
  "id": "12346",
  "client_name": "Петр Петров",
  "service_id": "568",
  "service_name": "Окрашивание",
  "appointment_datetime": "2023-05-15 14:30:00",
  "start_time": "2023-05-15 14:30:00",
  "end_time": "2023-05-15 16:00:00",
  "comment": "Заметка",
  "status": "booked",
  "is_custom": true
}
```

## API-эндпоинты

### Кастомные бронирования

- `GET /custom_appointments` - получение списка всех кастомных бронирований
- `POST /custom_appointments` - создание нового кастомного бронирования
- `PATCH /custom_appointments/{id}` - обновление существующего кастомного бронирования
- `DELETE /custom_appointments/{id}` - удаление кастомного бронирования

## Особенности реализации

### Редактирование кастомных бронирований

При редактировании кастомных бронирований:
1. Автоматически активируется режим ручного ввода времени
2. Пользователь может указать точное время начала и окончания
3. При отправке данных используется корректный эндпоинт для кастомных бронирований
4. Флаг `is_custom` используется для определения, какой эндпоинт нужно использовать

### Отображение времени

- Для обычных бронирований показывается только время начала
- Для кастомных бронирований показывается время начала и окончания

## Код

### Определение типа бронирования

```javascript
// Определяем, является ли бронирование кастомным
const isCustom = booking && booking.is_custom;

// Выбираем эндпоинт в зависимости от типа бронирования
const endpoint = isCustom 
  ? `${API_BASE}/custom_appointments/${bookingId}` 
  : `${API_BASE}/appointments/${bookingId}`;
```

### Ручной ввод времени

```jsx
{manualTimeInput ? (
  <div className="manual-time-input">
    <input type="time" value={startTime} onChange={handleStartTimeChange} />
    <input type="time" value={endTime} onChange={handleEndTimeChange} />
  </div>
) : (
  // Отображение выбора слотов
)}
```

## Рекомендации по работе с кастомными бронированиями

1. **Проверка типа**: Всегда проверяйте тип бронирования перед отправкой запросов
2. **Валидация времени**: Убедитесь, что время окончания позже времени начала
3. **Обработка ошибок**: Обрабатывайте потенциальные ошибки API при работе с разными эндпоинтами